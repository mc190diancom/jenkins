<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>道路运输行业现场稽查系统</title>
		<include file="Public:common" />
		
		<!--  -->

		<link rel="stylesheet" type="text/css" href="__CSS__/index.css"/>
		<link rel="stylesheet" type="text/css" href="__CSS__/search.css"/>
		<link rel="stylesheet" type="text/css" href="__CSS__/aduit.css"/>
		<script src="__JS__/layer/layer.js"></script>
		<script type="text/javascript" src="__JS__/laydate.js"></script>
		<link rel="stylesheet" type="text/css" href="__CSS__/query.css"/>



	</head>
	<body >
		
		<include file="Public:head" />
		
		<div class="center">
			<div class="center_left">
				<dl>
					<a href="{:U('Statistics/getStatisticsF')}"><dt class="dldt border" >执法稽查数量统计表</dt></a>
					<a href="{:U('Statistics/getStatisticsS')}"><dt class="dldt" style="line-height: 33px" >北京市交通执法总队<br>执法稽查数量统计表</dt></a>
					<a href="{:U('Home/Statistics/FzcjcList')}"><dt class="dldt">法制处检查表</dt></a>
				</dl>
			</div>

				<div class="center_right">

				<form action="##" method="post">	
				<div class="title_1 c-title">检索项</div>

				<div class="search_from" style="margin-top: 10px; height: 100%; width: 100%;">
					<dl style="position: relative">

						<dd>
							<div class="left">行业</div>
							<div class="right">
								<input type="text" readonly style="height: 25px;" class="input xxl" name="hy" id="hy" value="--请选择--" />
								<ul class="dadui" id="hangye" style="display:none;">
									<li>全部</li>
									<volist name="urc_hy" id="v">
										<li value="{$v.name}">{$v.name}</li>
									</volist>
								</ul>
							</div>
							<div class="clear"></div>
							
						</dd>
						<dd>
							<div class="left">大队</div>
							<div class="right">
								<input type="text" readonly style="height: 25px;" class="input xxl" name="dd" id="dd" value="--请选择--" />
								<ul class="dadui" id="dadui"  style="width:60%;display:none;">
									<li>全部</li>
									<volist name="compName" id="v">
										<li value="{$v.ZFDWMC}">{$v.ZFDWMC}</li>
									</volist>
								</ul>
							</div>
							<div class="clear"></div>

						</dd>
						<dd >
							<div class="left">中队</div>
							<div class="right">
								<input type="text" readonly style="height: 25px; " class="input xxl" name="zd" id="zd" value="--请选择--" />
								<ul class="dadui"  id="zhongdui" style="display:none;"></ul>
							</div>
							<div class="clear"></div>
						</dd>
						<dd >
							<div class="left">车组</div>
							<div class="right">
								<input type="text" readonly style="height: 25px;" class="input xxl" name="cz" id="cz" value="--请选择--" />
								<ul class="dadui" id="chezu" style="display:none;"></ul>
							</div>
							<div class="clear"></div>

						</dd>
						<dd>
							<div class="left">起始时间</div>
							<div class="right">
								<input placeholder="请输入日期" name="startTime" class="easyui-datetimebox" style="height: 25px;width: 100%;position: relative;border: 1px solid #41C3D6;border-radius: 0;" id="demo" value="{$startDate}">
							</div>
							<div class="clear"></div>
						</dd>
						<dd>
							<div class="left">结束时间</div>
							<div class="right">
								<input placeholder="请输入日期" name="endTime" class="easyui-datetimebox" style="height: 25px;width: 100%;position: relative;border: 1px solid #41C3D6;border-radius: 0;" id="demo1" value="{$endDate}">
							</div>
							<div class="clear"></div>
						</dd>
						<div class="submit">			
							<input type="button" name="" id="search_btn" value="查询" />               
						</div>
						<div class="clear"></div>

					</dl>
					<div class="clear"></div>
				</div>
				<!-- <div class="submit">			
					<input type="button" name="" id="search_btn" value="查询" />                           
				</div> -->
				</form>


				</form>

				<!-- =============结果====================== -->
				<div style="margin-top:30px;margin-bottom:110px;">
						<div class="center_right_top table-responsive">
							<span>查询结果</span>
							<!-- <div class="delAll">删除选择项</div> -->
							<div class="clear"></div>
						</div>
						<div class="center_right_botton">
							<input type="hidden" id="nums" name="" value="">
							<!--startprint6-->
							<table id="table" data-height="268" class="table table-striped table-bordered table-hover">
							    <thead>
							    <tr>
							        <!-- <th data-field="state" data-checkbox="true"></th>
							        <th data-field="ID" data-align="center" data-sortable="true"></th> -->
							        <th data-field="key" data-align="center" data-sortable="true"><div style="width:100px">序号</div></th>
							        <th data-field="zfdwmc" data-align="center" data-sortable="true"><div style="width:220px">大队</div></th>
							        <th data-field="sszd" data-align="center" data-sortable="true"><div style="width:100px">中队</div></th>
							        <th data-field="sscz" data-align="center" data-sortable="true"><div style="width:100px">车组</div></th>
							        <th data-field="zfry1" data-align="center" data-sortable="true"><div style="width:70px">执法人员1</div></th>
							        <th data-field="zfry2" data-align="center" data-sortable="true"><div style="width:70px">执法人员2</div></th>
							        <th data-field="normal" data-align="center" data-sortable="true"><div style="width:100px">正常量</div></th>
							        <th data-field="illegal" data-align="center" data-sortable="true"><div style="width:100px">违规量</div></th>
							        <th data-field="total" data-align="center" data-sortable="true"><div style="width:100px">总计</div></th>
							        
							        <!-- <th data-field="action" data-formatter="actionFormatter" data-align="center" data-events="actionEvents"><div style="width:150px">操作</div></th> -->
							    </tr>
							    </thead>
							</table>
							<!--endprint6-->
						
						</div>
							
						<!-- <div class="return">
							<input type="submit" onclick="preview(6)" name="" id="" value="打印" /> 
						</div> -->
						<!-- <div class="return" style="margin-right: 15px">
							<a href="javascript:ExportCsv();"><input type="submit" name="" id="" value="导出" /> </a>
						</div> -->
					</div>	


				</div>
				<!-- =============结果====================== -->

			<div style="clear:both;"></div>
		</div>
		
		
	</body>

</html>

<script>

	$("#dd").click(function(event){
		event.stopPropagation();
		$("#dadui").show(); 
		$('#dadui li').unbind('click'); 
		$("#dadui li").click(function(e){
			e.stopPropagation();
			var ht = $(this).html() ;
			$("#dd").val(ht);
			$("#dadui").hide();
			$.ajax({
				type : 'POST',
				url : '__APP__/Home/Admin/getGroups',
				data : {
					zfdwmc : ht,
				},
				dataType : 'json',
				timeout : 3000,
				success : function(data) {
					var str = '<li>全部</li>';
					for (var i = 0; i < data.length; i++) {
						str += '<li value="'+data[i]['SSZD']+'">'+data[i]['SSZD']+'</li>'
					};
					$("#zhongdui").hide();
					$('#zhongdui').html(str);

					//$('#chezu').html(str);
					$('#zd').val('--请选择--');
					$('#cz').val('--请选择--');
					
					 //console.log(data);
				}
			});
		})
	});
	$("#zd").click(function(event){
		event.stopPropagation();
		$("#zhongdui").show();
		var zhongdui = $("#zhongdui").html();
		
		$('#zhongdui li').unbind('click');
		$("#zhongdui li").click(function(){
			var sszd = $(this).html() ;
			$("#zhongdui").hide();
			$("#zd").val(sszd);
			var zfdwmc = $("#dd").val();
			//$("#zhongdui").addClass('disshow');
			$.ajax({
				type : 'POST',
				url : '__APP__/Home/Admin/getGroups',
				data : {
					zfdwmc : zfdwmc,
					sszd : sszd,
				},
				dataType : 'json',
				timeout : 3000,
				success : function(data) {
					var str = '<li>全部</li>';
					for (var i = 0; i < data.length; i++) {
						str += '<li value="'+data[i]['SSCZ']+'">'+data[i]['SSCZ']+'</li>'
					};
				
					$("#chezu").hide();
					$('#chezu').html(str);
					$('#cz').val('--请选择--');

					
					 //console.log(data);
				}
			});
		})
	});
	$("#cz").click(function(event){
		event.stopPropagation();
		$("#chezu").show();
		
		var chezu = $("#chezu").html();
		
		$('#chezu li').unbind('click');
		$("#chezu li").click(function(){
			$("#chezu").hide();
			var cz = $(this).html() ;
			$("#cz").val(cz);
			//$("#chezu").removeClass('disshow');
		})
	});
	$("#hy").click(function(event){
		event.stopPropagation();
		
		$("#hangye").show();
		$("#hangye li").click(function(){
			var ht = $(this).html() ;
			$("#hy").val(ht);
			$("#hangye").hide();
		})
	})

	$(document).click(function(){
	    $("#dadui").hide();
	    $("#zhongdui").hide();
	    $("#chezu").hide();
	    $("#hangye").hide();
	});
</script>
<script type="text/javascript">

		//重新装载数据
	function loadData(){
        //获得查询参数
        var dd = $("#dd").val();
        var zd = $("#zd").val();
        var cz = $("#cz").val();
        var hy = $("#hy").val();//稽查编号
        var st = $("input[name='startTime']").val();
        var end = $("input[name='endTime']").val();
        function getParams(params){
            var vNameReg = /^[\u4e00-\u9fa5]{1}[A-Z]{1}[A-Z_0-9]{5}$/;
            var driverNameReg = /^[\u4E00-\u9FA5]{1,6}$/;
            var corpNameReg = /^[\u4E00-\u9FA5]{0,}$/;
            var cyzgReg = /^\w+$/;
            if(st != '' || end !=''){
                if(st>=end){
                    layer.alert('开始时间不能大于结束时间', {
                        skin: 'layui-layer-molv' //样式类名
                        ,closeBtn: 0
                    } )
                    return false;
                }
            }
            if(hy=='--请选择--'){
                hy = '';
            }
            if(dd=='--请选择--'){
                dd = '';
            }
            if(zd=='--请选择--'){
                zd = '';
            }
            if(cz=='--请选择--'){
                cz = '';
            }
            var temp  = {
                limit: params.limit,   //页面大小
                offset: params.offset,  //页码
                maxrows: params.limit,
                pageindex:params.pageNumber,
                startTime:st,
                endTime:end,
                dd:dd,
                zd:zd,
                cz:cz,
                hy:hy,
            };
            return temp;
        }
        $('#table').bootstrapTable('refreshOptions',{pageNumber:1,queryParams:getParams});
	}

	$(function () {
		/****/
        //获得查询参数
			var dd = $("#dd").val();
			var zd = $("#zd").val();
			var cz = $("#cz").val();
			var hy = $("#hy").val();//稽查编号
			var st = $("input[name='startTime']").val();
			var end = $("input[name='endTime']").val();
        function getParams(params){
            var vNameReg = /^[\u4e00-\u9fa5]{1}[A-Z]{1}[A-Z_0-9]{5}$/;
            var driverNameReg = /^[\u4E00-\u9FA5]{1,6}$/;
            var corpNameReg = /^[\u4E00-\u9FA5]{0,}$/;
            var cyzgReg = /^\w+$/;
            if(st != '' || end !=''){
                if(st>=end){
                    layer.alert('开始时间不能大于结束时间', {
                        skin: 'layui-layer-molv' //样式类名
                        ,closeBtn: 0
                    } )
                    return false;
                }
            }
            if(hy=='--请选择--'){
                hy = '';
            }
            if(dd=='--请选择--'){
                dd = '';
            }
            if(zd=='--请选择--'){
                zd = '';
            }
            if(cz=='--请选择--'){
                cz = '';
            }
            var temp  = {
                limit: params.limit,   //页面大小
                offset: params.offset,  //页码
                maxrows: params.limit,
                pageindex:params.pageNumber,
                startTime:st,
                endTime:end,
                dd:dd,
                zd:zd,
                cz:cz,
                hy:hy,
            };
            return temp;
        }

		var height = $(document).height();
		$('.center .center_left').css('min-height',height+150);

		$('#table').bootstrapTable({
	        url: '__APP__/Home/Statistics/ajaxStatisticsF',         //请求后台的URL（*）
            method: 'get',                      //请求方式（*）
            toolbar: '#toolbar',                //工具按钮用哪个容器
            striped: true,                      //是否显示行间隔色
            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true,                   //是否显示分页（*）
            //locales:"zh-US", //表格汉化
            sortable: false,                     //是否启用排序
            sortOrder: "asc",                   //排序方式
            queryParams: getParams,//传递参数（*）
            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
            pageNumber:1,                       //初始化加载第一页，默认第一页
            pageSize: 10,                       //每页的记录行数（*）
            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
            strictSearch: true,
            clickToSelect: true,                //是否启用点击选中行   
            height: false,                    //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            uniqueId: "id",                     //每一行的唯一标识，一般为主键列
            cardView: false,                    //是否显示详细视图
            detailView: false,                   //是否显示父子表
            formatLoadingMessage: function () {
            	/*$("th[data-field='ID']").hide();
            	$("tr td:nth-child(2)").hide();*/
			    return "请稍等，正在加载中...";
			  },
			formatNoMatches: function () {  //没有匹配的结果
				/*$("th[data-field='ID']").hide();
            	$("tr td:nth-child(2)").hide();*/
			    return '无符合条件的记录';
			},
            onLoadError: function (data) {
            	/*$("th[data-field='ID']").hide();
            	$("tr td:nth-child(2)").hide();*/
			    //console.log(data);
			 },  
            onLoadSuccess: function(data){  //加载成功时执行  
            	if(data.total==0 || data.total==null){
              		layer.alert('系统没有查询到任何记录！', {
						skin: 'layui-layer-molv' //样式类名
						,closeBtn: 0
					} );
					$('#table').bootstrapTable('removeAll');//清空数据表
					return false;
              	}else if(data==undefined||data==null){
              		layer.alert('服务器忙，稍后再查！', {
						skin: 'layui-layer-molv' //样式类名
						,closeBtn: 0
					} );
					$('#table').bootstrapTable('removeAll');//清空数据表
					return false;
              	}
       //      	$('#table').find('input[name="btSelectItem"]').each(function(){
			    // 	var value = $(this).attr('data-index');
			    // 	alert(value);
			    // })
              //layer.msg("加载成功"); 
				/*$("th[data-field='ID']").hide();
				$("tr td:nth-child(2)").hide();*/
              
            },
			
	    });

	    $('#search_btn').bind('click',function(){
			loadData();
		});

	   
	    
	    
	});
</script>

<script type="text/javascript">
	
	//导出
	function ExportCsv(){
		var dd = $("#dd").val();
		var zd = $("#zd").val();
		var cz = $("#cz").val();
		var hy = $("#hy").val();//稽查编号
		var st = $("input[name='startTime']").val();
		var end = $("input[name='endTime']").val();

		if(hy=='--请选择--'){
			hy = '';
		}
		if(dd=='--请选择--'){
			dd = '';
		}
		if(zd=='--请选择--'){
			zd = '';
		}
		if(cz=='--请选择--'){
			cz = '';
		}
		var temp  = {
				startTime:st,
				endTime:end,
				dd:dd,
				zd:zd,
				cz:cz,
				hy:hy,
				offset: 0,  //页码
            	maxrows: 1,
		}
		$.getJSON("__APP__/Home/Statistics/ajaxStatisticsF",temp,function(json){
		    		//console.log(json);
		    if(json.total==0){
				layer.msg('数据为空,不能导出', {icon: 2});
			}else if(json.total > 10000){
				layer.msg('一次导出数据不能超过1万条，请修改查询条件', {icon: 2});
			}else{
				layer.msg('导出,暂未开通', {icon: 2});
				//alert(json.total);
				//window.location.href = "__APP__/Home/ExportCsv/StatisticsFAllList?dd="+dd+"&zd="+zd+"&cz="+cz+"&hy="+hy+"&startTime="+st+"&endTime="+end;
			}
		});
	}
</script>


